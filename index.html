<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparador de Arquivos XLSX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados */
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Previne a rolagem do corpo da página */
        }
        .highlight {
            background-color: #facc15; /* yellow-400 */
            color: #111827; /* gray-900 */
            font-weight: bold;
            border-radius: 3px;
            padding: 1px 2px;
        }
        /* Estilo para a linha atualmente selecionada pelo botão flutuante */
        tbody tr.current-row {
            background-color: rgba(59, 130, 246, 0.2); /* bg-blue-500 com opacidade */
            --tw-ring-color: #3b82f6;
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
            outline: 2px solid var(--tw-ring-color);
            outline-offset: -2px;
        }
        /* ATUALIZADO: Adicionada margem de rolagem para as linhas da tabela */
        tbody tr {
            /* Deixa uma margem no topo ao rolar, evitando que a linha fique sob o cabeçalho fixo. */
            scroll-margin-top: 45px; 
        }

        /* NOVO: Estilo para indicar que uma área de arquivo é um alvo de drop válido */
        .drag-over {
            border: 2px dashed #3b82f6 !important; /* blue-500 */
            background-color: #1f2937 !important; /* gray-800 */
        }

        /* Custom scrollbar for better dark mode aesthetics */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background-color: #4b5563; /* gray-600 */
            border-radius: 20px;
            border: 3px solid #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #6b7280; /* gray-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="h-[calc(100vh-20px)] m-2.5 w-auto flex flex-col bg-gray-800 rounded-lg shadow-2xl">
        <div id="control-bar" class="flex-shrink-0 p-2 bg-gray-800 border-b border-gray-700 space-y-2">
            <div class="flex flex-wrap items-center gap-x-4 gap-y-2">
                <button id="info-btn" class="flex-shrink-0 h-7 w-7 flex items-center justify-center bg-blue-600 hover:bg-blue-700 rounded-full text-white font-bold text-sm transition-colors" title="Instruções">?</button>
                
                <label for="file-input-1" class="text-sm px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-md cursor-pointer transition-colors">Arquivo Base</label>
                <input type="file" id="file-input-1" class="hidden" accept=".xlsx">
                <span id="file-name-1" class="text-xs text-green-400 max-w-xs truncate">Nenhum selecionado</span>

                <label for="file-input-2" class="text-sm px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-md cursor-pointer transition-colors">Arquivo Novo</label>
                <input type="file" id="file-input-2" class="hidden" accept=".xlsx">
                <span id="file-name-2" class="text-xs text-green-400 max-w-xs truncate">Nenhum selecionado</span>

                <button id="compare-btn" class="text-sm px-4 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold rounded-md transition-colors">Comparar</button>
                
                <div class="flex-grow">
                    <input type="text" id="filter-input" placeholder='Filtrar... (use "" para frases, ex: "termo 1" termo2)' class="w-full text-sm p-1.5 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-blue-500">
                </div>
            </div>
             <div class="grid grid-cols-3 items-center min-h-[20px]">
                <div id="status-container" class="text-xs text-yellow-300"></div>
                <div id="filter-status" class="text-xs text-gray-400 text-center"></div>
                <div></div> </div>
        </div>

        <div id="predefined-filters-container" class="flex-shrink-0 p-2 border-b border-gray-700 flex flex-wrap items-center gap-x-3 gap-y-2 hidden">
             </div>


        <div id="results-container" class="flex-grow flex flex-col overflow-hidden">
             <div id="table-wrapper" class="flex-grow overflow-auto bg-gray-900">
                <table class="min-w-full text-sm text-left text-gray-300 table-fixed">
                    <thead class="text-xs text-gray-300 uppercase bg-gray-700 sticky top-0 z-10">
                        <tr>
                            <th scope="col" class="px-6 py-3">Processo</th>
                            <th scope="col" class="px-6 py-3">SUPP</th>
                            <th scope="col" class="px-6 py-3">Diário</th>
                            <th scope="col" class="px-6 py-3">Órgão</th>
                            <th scope="col" class="px-6 py-3">Teor da NE</th>
                            <th scope="col" class="px-6 py-3">Critérios PGE</th>
                        </tr>
                    </thead>
                    <tbody id="results-tbody" class="bg-gray-800">
                        </tbody>
                </table>
            </div>
             <div id="no-results-message" class="flex-grow flex items-center justify-center text-gray-500 hidden">
                <p>Nenhum resultado encontrado para o filtro atual.</p>
            </div>
             <div id="initial-message" class="flex-grow flex items-center justify-center text-gray-500">
                <p>Aguardando arquivos para comparação...</p>
            </div>
        </div>
    </div>

    <div id="info-modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div id="info-modal" class="bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-2xl mx-4 border border-gray-700">
            <h2 class="text-2xl font-bold text-white mb-4">Instruções de Uso</h2>
            <div class="text-gray-300 space-y-3">
                <p><strong class="text-blue-400">1. Selecionar Arquivos:</strong> Clique nos botões "Arquivo Base" e "Arquivo Novo" ou arraste e solte suas planilhas .xlsx sobre eles. O "Arquivo Base" é a base de comparação e o "Arquivo Novo" contém os novos dados.</p>
                <p><strong class="text-blue-400">2. Comparar:</strong> Após selecionar os dois arquivos, clique no botão "Comparar". A aplicação irá processar os dados e exibir na tabela abaixo todas as linhas que estão no Arquivo Novo, mas NÃO no Arquivo Base, com base na 5ª coluna (Teor da NE).</p>
                <p><strong class="text-blue-400">3. Filtrar Resultados:</strong> Utilize o campo de filtro para refinar a busca nos resultados. Você pode usar o campo de texto ou clicar em um dos botões de "Filtros Rápidos".</p>
                <p><strong class="text-blue-400">4. Navegar na Tabela:</strong> A tabela pode ser rolada verticalmente e horizontalmente. Quando houver resultados, um botão flutuante com o texto "Próx." aparecerá no canto inferior direito para navegar linha a linha.</p>
            </div>
            <div class="mt-6 text-right">
                <button id="close-modal-btn" class="px-5 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition-colors">Fechar</button>
            </div>
        </div>
    </div>

    <button id="next-row-btn" title="Próxima Linha" class="hidden fixed bottom-6 right-6 h-12 px-5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-full flex items-center justify-center shadow-lg transition-transform duration-200 hover:scale-110">
        Próx.
    </button>


    <script>
    // Elementos da DOM
    const fileInput1 = document.getElementById('file-input-1');
    const fileInput2 = document.getElementById('file-input-2');
    const fileName1 = document.getElementById('file-name-1');
    const fileName2 = document.getElementById('file-name-2');
    // NOVO: Selecionar os labels que servirão como áreas de drop
    const dropZone1 = document.querySelector('label[for="file-input-1"]');
    const dropZone2 = document.querySelector('label[for="file-input-2"]');
    const compareBtn = document.getElementById('compare-btn');
    const statusContainer = document.getElementById('status-container');
    const resultsContainer = document.getElementById('results-container');
    const filterInput = document.getElementById('filter-input');
    const filterStatus = document.getElementById('filter-status');
    const resultsTbody = document.getElementById('results-tbody');
    const noResultsMessage = document.getElementById('no-results-message');
    const initialMessage = document.getElementById('initial-message');
    const tableWrapper = document.getElementById('table-wrapper');
    const infoBtn = document.getElementById('info-btn');
    const infoModalOverlay = document.getElementById('info-modal-overlay');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const nextRowBtn = document.getElementById('next-row-btn'); 
    const predefinedFiltersContainer = document.getElementById('predefined-filters-container');

    let differences = [];
    let displayColumns = [];
    let currentRowIndex = -1; 

    const PREDEFINED_FILTERS = ['#proc', '[audiencia]', '[pauta]', '[s]', '[trt4]', '[corag]'];

    function setupPredefinedFilters() {
        predefinedFiltersContainer.innerHTML = ''; 
        PREDEFINED_FILTERS.forEach(filterTerm => {
            const button = document.createElement('button');
            button.className = 'text-xs px-2.5 py-1 bg-gray-700 hover:bg-gray-600 rounded-md cursor-pointer transition-colors';
            button.dataset.filter = filterTerm
